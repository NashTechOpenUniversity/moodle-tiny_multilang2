define("tiny_multilang2/ui",["exports","./options"],(function(_exports,_options){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.onPreProcess=_exports.onInit=_exports.onDelete=_exports.onBeforeGetContent=_exports.applyLanguage=void 0;
/**
   * Commands for the plugin logic of the Moodle tiny_multilang2 plugin.
   *
   * @module      tiny_multilang2
   * @author      Iñaki Arenaza <iarenaza@mondragon.edu>
   * @author      Stephan Robotta <stephan.robotta@bfh.ch>
   * @copyright   2015 onwards Iñaki Arenaza & Mondragon Unibertsitatea
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
const _span_class='class="multilang-begin mceNonEditable"',_span_fixed_attrs="<span "+_span_class+' data-mce-contenteditable="false"',_span_multilang_begin=_span_fixed_attrs+' lang="%lang" xml:lang="%lang">{mlang %lang}</span>',_span_multilang_end=_span_fixed_attrs.replace("begin","end")+">{mlang}</span>",isNull=a=>null==a,_add_visual_styling=function(ed){let content=ed.getContent();return-1!==content.indexOf(_span_class)||(content=content.replace(new RegExp("{\\s*mlang\\s+([^}]+?)\\s*}","ig"),(function(match,p1){return _span_multilang_begin.replace(new RegExp("%lang","g"),p1)})),content=content.replace(new RegExp("{\\s*mlang\\s*}","ig"),_span_multilang_end)),content},_remove_visual_styling=function(ed){["begin","end"].forEach((function(t){let nodes=ed.dom.select("span.multilang-"+t);for(let n=0,l=nodes.length;n<l;n++){const span=nodes[n];ed.dom.setOuterHTML(span,span.innerHTML.toLowerCase())}}))},_get_highlight_node_from_select=function(ed,search){let span;return ed.dom.getParents(ed.selection.getStart(),(elm=>{if(!isNull(elm.classList)){const pair="begin"===search?"end":"begin";if(elm.classList.contains("multilang-"+pair)){span=elm;do{span="begin"===search?span.previousSibling:span.nextSibling}while(!isNull(span)&&(isNull(span.classList)||!span.classList.contains("multilang-"+search)))}else elm.classList.contains("multilang-"+search)&&(span=elm)}})),span};_exports.onInit=function(ed){(0,_options.isContentToHighlight)(ed)&&(ed.dom.addStyle((0,_options.getHighlightCss)(ed)),ed.setContent(_add_visual_styling(ed)))};_exports.onBeforeGetContent=function(ed,content){if(void 0!==content.source_view&&!0===content.source_view){var onClose=function(ed){ed.off("close",onClose),ed.setContent(_add_visual_styling(ed))};ed.on("CloseWindow",(()=>{onClose(ed)})),(0,_options.isContentToHighlight)(ed)&&_remove_visual_styling(ed)}};_exports.onPreProcess=function(ed,node){void 0!==node.save&&!0===node.save&&(0,_options.isContentToHighlight)(ed)&&_remove_visual_styling(ed)};_exports.onDelete=function(ed,event){if(event.isComposing||46!==event.keyCode||!(0,_options.isContentToHighlight)(ed))return;const begin=_get_highlight_node_from_select(ed,"begin"),end=_get_highlight_node_from_select(ed,"end");isNull(begin)||isNull(end)||(event.preventDefault(),ed.dom.remove(begin),ed.dom.remove(end))};_exports.applyLanguage=function(ed,iso){if(null===iso)return;let text=ed.selection.getContent();if(""===text.toString().replace(/^\s+/,"").replace(/\s+$/,"")){let newtext;return newtext=(0,_options.isContentToHighlight)(ed)?_span_multilang_begin.replace(new RegExp("%lang","g"),iso)+" "+_span_multilang_end:"{mlang "+iso+"} {mlang}",void ed.insertContent(newtext)}if(!(0,_options.isContentToHighlight)(ed))return void ed.selection.setContent("{mlang "+iso+"}"+text+"{mlang}");const span=_get_highlight_node_from_select(ed,"begin");if(!isNull(span))return void ed.dom.setOuterHTML(span,_span_multilang_begin.replace(new RegExp("%lang","g"),iso));const newtext=_span_multilang_begin.replace(new RegExp("%lang","g"),iso)+text+_span_multilang_end;ed.selection.setContent(newtext)}}));

//# sourceMappingURL=ui.min.js.map